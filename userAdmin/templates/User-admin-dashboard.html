<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../static/css/output.css">
  <title>Gymnify</title>
</head>
<body class="m-0 p-0 border-none outline-none box-border font-poppins bg-[#FAFBFF] overflow-x-auto overflow-y-hidden">

<main class="flex gap-2 w-full ">

  <div id="sideBar" class="sidebar visible sticky top-0 left-0 bottom-0 max-side-bar:min-w-[110px] side-bar:min-w-[240px] h-screen px-7 max-side-bar:px-5 text-white overflow-hidden bg-white-gray bg-white max-sm:hidden">
    <div class="text-lg text-black font-bold pl-[26px] max-side-bar:pl-9 py-4  absolute space-x-6 w-full top-0 left-0">
      <div class="flex items-center  space-x-10"><img class="h-12 w-auto" src="../../static/assets/logo/logo.svg" alt="">
        <span class="max-side-bar:hidden">Gymnify.</span>
      </div>
    </div>
    <div class="logo h-40 p-4 ">

    </div>

    <ul class="h-[88%] relative list-none p-0">
      <li  class="p-4 my-2 rounded-md hover:bg-slate-200 hover:text-light-gray transition-all duration-700 bg-blue-violet cursor-pointer"> 
        <a href="user-admin-dashboard" class="text-sm flex items-center  gap-6">
          <img width="27" height="27" class="opacity-50" src="../../static/assets/logo/dashboard.png">
          <span class="overflow-hidden max-side-bar:hidden">Dashboard</span>
        </a>
      </li>

      <li class="p-4 my-2 rounded-md hover:bg-slate-200 transition-all duration-700 text-light-gray cursor-pointer bg-white "> 
        <a href="user-admin-income" class="text-sm flex items-center gap-6 ">
          <img width ="27" height="27" class="opacity-50" src="../../static/assets/logo/income.png">
          <span class="overflow-hidden max-side-bar:hidden">Income</span>
        </a>
      </li>
     
      <div class="profile grid grid-cols-2  absolute bottom-28 left-2  w-full text-sm -space-x-3">
        <div class="bg-soft-teal h-12 w-12 mt-1 rounded-full text-white">

        </div>

        <div class="grid grid-rows-2 -space-y-2 max-side-bar:hidden">
          <div class=" text-black">
            Gymnify
          </div>
          <div class=" text-light-gray">
            Managment System
          </div>
        </div>
      </div>
    </ul>
  </div>

   <!-- /* ---------------------------*/ -->


 <div class="main-content flex-1 relative bg-none w-full p-4 overflow-x-scroll overflow-y-hidden ">

  <div class="header--wrapper flex justify-between items-center flex-wrap bg-white shadow-lg  rounded-lg border-black border-opacity-10 border px-2.5 py-7 mb-4 max-scroll:min-w-[510px]">
    <div class="header-title ">
      <h2 class="text-2xl text-soft-teal">Dashboard</h2>
    </div>
 

    <div id="hamBurger" onclick="sideBarToggle()"><img width="27" height="27" src="../../static/assets/logo/visible.png" alt="" srcset=""></div>
      <div class="user--info flex items-center space-x-14 max-md:space-x-8 pr-4 cursor-pointer">

        <div class="relative"> 
  <!-- Notification Icon -->
  <img id="notButton"  width="27" height="27" src="../../static/assets/logo/notification.png" class="opacity-50 cursor-pointer" alt="">
    {% if notifications %}

  <div id="notContent" class="grid grid-cols-1 items-start justify-center gap-8 shadow-lg p-6 border border-solid border-black rounded-md border-opacity-35 absolute -right-28 top-20 -z-10 bg-white
              opacity-0 scale-95  
              transition-all duration-500 ease-in-out w-[590px] h-[378px] overflow-y-auto">
    {% for notification in notifications %}
    <div class="text-active-text text-opacity-90 hover:bg-gray-200 w-full p-6 transition-colors duration-300 hover:text-black border border-opacity-10 border-black relative" >
   
      <h1 class="font-bold mb-3">ðŸ”” {{notification.type}}</h1>
      <p><span class="font-bold">Company:</span> {{notification.company}}</p>
      <p><span class="font-bold">Package:</span> {{notification.package}}</p>
      <p><span class="font-bold">Expired on:</span> {{expiry_date}}â€”
        {% if days_left == 0%} 
        Expired today
        {% elif days_left < 0 %}
        Already expired
        {% else %}
        in {{days_left}} days

        {% endif %}

        </p>
      <p class="italic text-slate-gray ml-2">[{{notification.date}}]</p>
      <button class="absolute top-20 right-[1.6rem] text-black z-50 hover:text-red-400" onclick="this.parentElement.remove();">âœ–</button>
      <button  class="absolute top-32 right-5 text-black z-50 hover:text-red-400"><img width="25" height="25" src="../../static/assets/logo/delete.png" data-id = "{{notification.id}}" data-company = "{{notification.company}}" onclick="deleteNotification(this)"></button>
        </div>

    {% endfor %}

    {% else %}
     <div id="notContent" class="grid grid-cols-1 items-start justify-center gap-8 shadow-lg p-6 border border-solid border-black rounded-md border-opacity-35 absolute -right-28 top-20 -z-10 bg-white
              opacity-0 scale-95  
              transition-all duration-500 ease-in-out w-[590px]">
          <p><span class="font-bold mr-2">No notifications at the moment.</span>Notifications will be recieved when the expiry date is approaching, specifically when there are<br> -> 90, <br>  -> 75, <br> -> 50, <br> -> 35, <br>-> 20, <br> -> 5 or <br> -> 3 days left. </p>

    {% endif %}

      

  
  </div>
</div>
<a href="message">
      <img width="27" height="27" src="../../static/assets/logo/message.png" class="opacity-50" alt="">
    </a>
  </div>

     <!-- /* ---------------------------*/ -->
     </div>


  <div class="grid grid-cols-3 gap-4 bg-white shadow-lg rounded-xl px-1 py-6 max-card:grid-cols-2 mb-4  max-md:place-items-center max-scroll:min-w-[510px] ">
  
    <div class="grid grid-cols-2  place-items-center">
  
      <div class="bg-green-100 p-4 rounded-full">
        <img src="../../static/assets/logo/card-1.svg" alt="icon" width="27" height="27">
      </div>
      <div class="flex flex-col items-start justify-center">
      <p class="text-gray-500 mt-2 text-sm">Total Customers</p>
      <h2 class="text-2xl font-bold">{{total_customers}}</h2>
      <p class="text-sm flex items-center gap-1">
        <span><img src="../../static/assets/logo/arrow-up.svg" alt=""></span> <span class="text-green-500">8%</span> this month
      </p>
    </div>
    </div>
  
    <div class="grid grid-cols-2 place-items-center md:">
      <div class="bg-green-100 p-4 rounded-full">
        <img src="../../static/assets/logo/card-2.svg" alt="icon" width="27" height="27">
      </div>
  
      <div class="flex flex-col items-start justify-center">
      <p class="text-gray-500 mt-2 text-sm">Members</p>
      <h2 class="text-2xl font-bold">{{total_users}}</h2>
      <p class="text-sm flex items-center gap-1">
        <span><img src="../../static/assets/logo/arrow-down.svg" alt=""></span>  <span class="text-red-700">1%</span> this month
      </p>
  
    </div>
    </div>
  
    <div class="grid grid-cols-2 place-items-center md:-space-x-5">
      <div class="bg-green-100 p-4 rounded-full">
        <img src="../../static/assets/logo/card-3.svg" alt="icon" width="27" height="27">
      </div>
  
      <div class="flex flex-col items-start justify-center">
      <p class="text-gray-500 mt-2 text-sm">      
        Active now
      </p>
      <h2 class="text-2xl font-bold">{{total_active_users }}</h2>
      <p class="text-white text-sm flex items-center gap-1">
        <span class="text-white">â–¼</span> 1% this month
      </p>
  
    </div>
    </div>
  
   
  
  </div>

     <!-- /* ---------------------------*/ -->


  <div class="p-6 bg-white shadow-lg rounded-lg overflow-x-auto lg:overflow-x-scroll max-scroll:min-w-[510px] relative z-40">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl max-md:text-sm font-semibold">All Customers</h2>
        <div class="flex gap-4">
            <div class="relative">
                <input type="text" placeholder="Search" class="border rounded-lg px-3 py-1.5 text-sm focus:outline-none ">
            </div>
            <div>
                <select id="sortSelect" class="border rounded-lg px-3 py-1.5 text-sm focus:outline-none">
                  <option class="text-gray-400" disabled selected>Sort by:</option>
                  <option class="font-bold">Newest</option>
                  <option>Oldest</option>
              </select>
            </div>
        </div>
    </div>
    <div class="">
        <table class="w-full min-w-[1000px]  border-separate border-spacing-y-4 border-none text-left text-sm">
            <thead">
                <tr>
                    <th class="p-3 text-light-gray opacity-50 font-normal relative">Gym House<button class="absolute"><img src="../../static/assets/logo/sort-by.svg" ></button></th>
                    <th class="p-3 text-light-gray opacity-50 font-normal relative ">Time line <button class="absolute"><img src="../../static/assets/logo/sort-by.svg" ></button> </th>
                    <th class="p-3 text-light-gray opacity-50 font-normal ">Phone Number</th>
                    <th class="p-3 text-light-gray opacity-50 font-normal ">Email</th>
                    <th class="p-3 text-light-gray opacity-50 font-normal relative ">Service Type <button class="absolute"><img src="../../static/assets/logo/sort-by.svg" ></button></th>
                    <th class="p-3 text-light-gray opacity-50 font-normal relative">Payment Activation<button class="absolute"><img src="../../static/assets/logo/sort-by.svg" ></button></th>
                    <th class="p-3 text-light-gray opacity-50 font-normal relative">Payment Status<button class="absolute"><img src="../../static/assets/logo/sort-by.svg" ></button></th>
                </tr>
            </thead>
            <tbody>
               {% for gymer in gymers%}
                <tr class="border-t bg-white shadow-sm">
                    <td class="p-3">{{gymer.name}}</td>
                    <td class="p-3">{{gymer.timeline}}</td>
                    <td class="p-3">{{gymer.phoneNumber}}</td>
                    <td class="p-3">{{gymer.email}}</td>
                    <td class="p-3">{{gymer.service_type}}</td>
                    <td class="p-3">
                      {% if gymer.payDone %}
                      <button onclick="toggleStatus('{{ gymer.gymer_id }}')" class="bg-red-300 text-white border-red-400 border text-active-text px-2 py-1 rounded">Inactive</button>
                      {% else %}
                      <button onclick="toggleStatus('{{ gymer.gymer_id }}')" class="bg-opacity-30 bg-[rgba(0,255,0,0.3)] border-stroke border text-active-text px-2 py-1 rounded">Active</button>
                      {% endif %}
                  </td>

                    <td class="p-3 -gtext-red-400">{{gymer.payment_status}}</td>

                </tr>
             
            </tbody>
            {% endfor %}
        </table>
    </div>
    <div class="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>Showing data 1 to 8 of (total entries) entries</span>
        <div class="flex gap-1">
            <button class="border px-2 py-1 rounded">&lt;</button>
            <button class="bg-blue-500 text-white px-2 py-1 rounded">1</button>
            <button class="border px-2 py-1 rounded">2</button>
            <button class="border px-2 py-1 rounded">...</button>
            <button class="border px-2 py-1 rounded">40</button>
            <button class="border px-2 py-1 rounded">&gt;</button>
        </div>
    </div>
</div>

 </div>

 


</main>


<script>

 // Function to get CSRF token
 function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Function to toggle status
function toggleStatus(gymerId) {
            const csrfToken = getCookie('csrftoken');
            console.log('Button clicked. Gymer ID:', gymerId); // Debugging

            fetch('/toggle-status/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ gymer_id: gymerId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Reload the page to reflect the updated status
                    location.reload();
                } else {
                    alert('Failed to update status: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }


  notificationButton = document.getElementById('notButton')      
  notificationContent = document.getElementById('notContent')

  notificationButton.addEventListener('click', () => {
    notificationContent.classList.toggle('opacity-100')
    notificationContent.classList.toggle('z-50')

    console.log('Hello Wolrd')

  })


   
function deleteNotification(element){ 
  const notificationId = element.dataset.id
  const company = element.dataset.company
  
  fetch('/delete-notification', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': '{{ csrf_token}}'
    },
    body: JSON.stringify( {id: notificationId, company: company})
  })

  .then (response => {
    if(response.ok) {
      const closestDiv = element.closest("div.text-active-text")
      if(closestDiv){ 
        closestDiv.remove()
      }
    }
    else {
      alert('Failed to delete notification')
    }
  })

}


  

</script>
</body>
</html>